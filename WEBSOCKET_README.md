# WebSocket 客户端功能说明

## 功能概述

在订单查询系统插件中新增了WebSocket客户端功能，可以与WebSocket服务器进行实时通信。

## 主要特性

### 1. 连接管理
- **服务器配置**: 可配置服务器地址和协议
- **连接状态**: 实时显示连接状态（未连接/连接中/已连接/连接失败）
- **连接控制**: 支持连接和断开操作

### 2. 消息通信
- **自定义消息**: 可发送任意文本消息
- **快捷操作**: 内置Echo、随机数生成、快速计数等测试功能
- **实时接收**: 实时显示服务器返回的消息

### 3. 消息日志
- **分类显示**: 按类型区分发送、接收、系统、错误消息
- **时间戳**: 每条消息都带有时间戳
- **自动滚动**: 新消息自动滚动到底部
- **日志管理**: 支持清空日志功能

## 使用方法

### 1. 启动服务器
首先需要启动WebSocket服务器：
```bash
cd server
npm install
node index.js
```
服务器将在 `ws://localhost:8080` 上运行，使用 `test-protocol` 协议。

### 2. 连接服务器
1. 在插件界面中找到"WebSocket 连接"区域
2. 点击展开该区域
3. 确认服务器地址为 `ws://localhost:8080`
4. 确认协议为 `test-protocol`
5. 点击"连接"按钮

### 3. 测试功能

#### Echo 测试
- 在消息输入框中输入任意文本
- 点击"Echo"按钮
- 服务器将返回相同的消息

#### 随机数生成
- 点击"开启随机数"按钮
- 服务器将每250ms发送一个随机数
- 再次点击可关闭随机数生成

#### 快速计数
- 点击"开启快速计数"按钮
- 服务器将每1ms发送一个递增的数字
- 再次点击可关闭快速计数

#### 自定义消息
- 在消息输入框中输入任意文本
- 点击"发送"按钮或按回车键
- 消息将发送到服务器

## 服务器协议说明

服务器支持以下命令格式：

- `echo=消息内容` - 返回相同的消息
- `rand=on/off` - 开启/关闭随机数生成
- `fast=on/off` - 开启/关闭快速计数
- `validate=消息列表` - 验证消息完整性

## 注意事项

1. **连接状态**: 确保服务器正在运行且端口8080可用
2. **协议匹配**: 服务器和客户端必须使用相同的协议名称
3. **网络环境**: 如果在不同网络环境中，需要修改服务器地址
4. **错误处理**: 连接失败时会显示详细的错误信息
5. **资源清理**: 组件销毁时会自动断开WebSocket连接

## 技术实现

- **WebSocket API**: 使用原生WebSocket API
- **Vue.js集成**: 完全集成到现有的Vue.js组件系统中
- **响应式设计**: 支持不同屏幕尺寸
- **状态管理**: 完整的连接状态管理
- **错误处理**: 完善的错误处理和用户提示

## 故障排除

### 连接失败
1. 检查服务器是否正在运行
2. 确认端口8080未被占用
3. 检查防火墙设置
4. 验证服务器地址和协议

### 消息发送失败
1. 确认WebSocket连接状态为"已连接"
2. 检查网络连接
3. 查看浏览器控制台的错误信息

### 性能问题
1. 快速计数模式会产生大量消息，可能影响性能
2. 日志条目过多时建议定期清空
3. 长时间连接时注意内存使用情况 